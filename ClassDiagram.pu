@startuml sample

package "etrobocon2024" {
    package "module" {
        package "API" {
            class Controller{
                + static constexpr double MOTOR_PWM_MAX = 100.0
                + static constexpr double MOTOR_PWM_MIN = -100.0
                + Controller(rightWheel(PORT_B), leftWheel(PORT_C), armMortor(PORT_A))
                + void setRightMotorPwm(const double)
                + void setLeftMotorPwm(const double)
                + void resetRightMotorPwm()
                + void resetLeftMotorPwm()
                + void resetWheelsMotorPwm()
                + void stopWheelsMotor()
                + void setArmMotorPwm(const double)
                + void resetArmMotorPwm()
                + void stopArmMotor()
                + double getRightMotorPwm()
                + double getLeftMotorPwm()
                - ev3api::Motor rightWheel
                - ev3api::Motor leftWheel
                - ev3api::Motor armMotor
                - static double pwmOfRightWheel
                - static double pwmOfLeftWheel
                - static double pwmOfArm
                - double limitPwmValue(const double)
            }
            class Measurer {
                + Measurer()
                + int getBrightness()
                + rgb_raw_t getRawColor()
                + int getLeftCount()
                + int getRightCount()
                + int getArmMotorCount()
                + bool getLeftButton()
                + bool getRightButton()
                + bool getEnterButton()
                + int getForwardDistance()
                + double getVoltage()
                - ev3api::ColorSensor colorSensor
                - ev3api::SonarSensor sonarSensor
                - ev3api::Motor leftWheel
                - ev3api::Motor rightWheel
                - ev3api::Motor armMotor
            }
            class Timer {
                + Timer()
                + void sleep(int)
                + int now()
                - ev3api::Clock clock
            }
        }

        package "Calculator" {
            enum COLOR <<int>> {
                NONE = 0
                BLACK = 1
                WHITE = 2
                BLUE = 3
                GREEN = 4
                YELLOW = 5
                RED = 6
            }

            struct Hsv {
                - int hue
                - int saturation
                - int value
            }

            class ColorJudge {
                + ColorJudge() = delete
                + static COLOR getColor(rgb_raw_t const& rgb)
                + static COLOR stringToColor(const char* str)
                + static const char* colorToString(COLOR color)
                - static constexpr int SATURATION_BORDER = 27
                - static constexpr int BLACK_LIMIT_BORDER = 10
                - static constexpr int WHITE_LIMIT_BORDER = 250
                - static constexpr int BLACK_BORDER = 110
                - static constexpr int RED_BORDER = 25
                - static constexpr int YELLOW_BORDER = 50
                - static constexpr int GREEN_BORDER = 170
                - static constexpr int BLUE_BORDER = 300
                - static constexpr rgb_raw_t MAX_RGB = { 244, 245, 252 }
                - static constexpr rgb_raw_t MIN_RGB = { 9, 10, 10 }
                - static Hsv convertRgbToHsv(rgb_raw_t const& rgb)
            }

            class Mileage {
                + static double calculateWheelMileage(int angle)
                + static double calculateMileage(int rightAngle, int leftAngle)
                - Mileage()
            }

            struct PidGain {
                + double kp
                + double ki
                + double kd
                - PidGain(double _kp, double _ki, double _kd)
            }

            class Pid {
                + Pid(double _kp, double _ki, double _kd, double _targetValue)
                + void setPidGain(double _kp, double _ki, double _kd)
                + double calculatePid(double currentValue, double delta = 0.01)
                - PidGain pidGain
                - double prevDeviation
                - double integral
                - double targetValue
            }

            class SpeedCalculator {
                + SpeedCalculator(double _targetSpeed)
                + SpeedCalculator(double _rightTargetSpeed, double _leftTargetSpeed)
                + double calculateRightMotorPwmFromTargetSpeed()
                + double calculateLeftMotorPwmFromTargetSpeed()
                - const double rightTargetSpeed
                - const double leftTargetSpeed
                - Pid rightPid
                - Pid leftPid
                - Timer timer
                - Measurer measurer
                - double rightMotorPwm
                - double leftMotorPwm
                - double prevRightMileage
                - double prevLeftMileage
                - int prevRightTime
                - int prevLeftTime
                - static constexpr double K_P = 0.004
                - static constexpr double K_I = 0.0000005
                - static constexpr double K_D = 0.0007
                - static constexpr double R_K_P = 0.004
                - static constexpr double R_K_I = 0.0000005
                - static constexpr double R_K_D = 0.0007
                - double calculateSpeed(double diffMileage, double diffTime)
            }
        }

        package "common" {
            class Logger {
                + Logger()
                + void log(const char*)
                + void logWarning(const char*)
                + void logError(const char*)
                + void logHighlight(const char*)
                + void outputToFile()
                + void initLogs()
                - static char logs[65536]
            }
            class StringOperator {
                + static char* removeEOL(const char*)
                - StringOperator()
            }
        }

        package "Motion" {
            class ColorLineTracing
            LineTracing <|-- ColorLineTracing

            class ColorStraight
            Straight <|-- ColorStraight

            class DistanceLineTraicing
            LineTracing <|-- DistanceLineTraicing

            class DistanceStraight
            Straight <|-- DistanceStraight

            class EdgeChanging
            Motion <|-- EdgeChanging

            class LineTracing {
                + LineTracing(double _targetSpeed, int _targetBrightness, const PidGain& _pidGain,
              bool& _isLeftEdge)
                + void run()
                # virtual bool isMetPreCondition(double targetSpeed) = 0
                # virtual bool isMetContinuationCondition() = 0
                # virtual void logRunning()
                # double targetSpeed
                # int targetBrightness
                # PidGain pidGain
                # bool& isLeftEdge
                # double initLeftMileage
                # double initRightMileage
                # double initDistance
                # Timer timer
                # Measurer measurer
                # Controller controller
            }
            Motion <|-- LineTracing

            class Motion {
                + Motion()
                + virtual void run() = 0
                + virtual void logRunning() = 0
                # Logger logger
            }

            class PwmRotation {
                + PwmRotation(int _targetAngle, int _pwm, bool _isClockwise)
                + using Rotation::run
                + bool isMetPreCondition() override
                + bool isMetContCondition(double initLeftMileage, double initRightMileage, int leftSign, int rightSign) override
                + void logRunning() override
            }
            Rotation <|-- PwmRotation

            class Rotation {
                + Rotation(int _targetAngle, int _pwm, bool _isClockwise)
                + void run()
                + virtual bool isMetPreCondition() = 0
                + virtual bool isMetContCondition(double targetLeftDistance, double targetRightDistance, int leftSign, int rightSign) = 0
                + virtual void logRunning() = 0
                # int targetAngle
                # int pwm
                # bool isClockwise
                # Timer timer
                # Controller controller
                # Measurer measurer
            }
            Motion <|-- Rotation

            class Sleeping {
                + Sleeping(int milliSec)
                + void run()
                + void logRunning()
                - int milliSec
                - Timer timer
            }
            Motion <|-- Sleeping

            class Straight
            Motion <|-- Straight
        }

        enum Area
        class AreaMaster

        class Calibrator

        class EtRobocon2024

        enum COMMAND

        class MotionParser
    }
}

package "etrobocon2024-camera-system" {
    package "src" {
        class CameraSystem
        class Client
        class DetectObject
        class ImageProcessing
        class ResponseError
        class OfficialInterface
        class RoboSnap
        class TrainTracker
    }
}
@enduml
